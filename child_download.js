var _RepStrUtil=new function(){function e(e){if(!e)return 0;for(len=0,e=escape(e),i=0;i<e.length;i++,len++)"%"==e.charAt(i)&&("u"==e.charAt(++i)&&(i+=3,len++),i++);return len}return{Rep_htmlAttribute:function(e){return e?e.replace(/"/g,"&quot;"):""},Rep_htmlText:function(e){return e?e.replace(/</g,"&lt;").replace(/>/g,"&gt;"):""},Rep_webSQLjs:function(e){return e?e.replace(/'/g,"＜REP:’＞").replace(/%/g,"＜REP:％＞"):""},deRep_webSQLjs:function(e){return e?e.replace(/＜REP:’＞/g,"'").replace(/＜REP:％＞/g,"%"):""},Rep_filePath:function(e){return e?e.replace(/\\/g,"\\"):""},Rep_newRegExp:function(e){return e?e.replace(/\\/g,"\\\\").replace(/\^/g,"\\^").replace(/\$/g,"\\$").replace(/\*/g,"\\*").replace(/\?/g,"\\?").replace(/\)/g,"\\)").replace(/\(/g,"\\(").replace(/\./g,"\\.").replace(/\(\?\:/g,"\\(\\?\\:").replace(/\(\?\=/g,"\\(\\?\\=").replace(/\(\?\!/g,"\\(\\?\\!").replace(/\|/g,"\\|").replace(/\{/g,"\\{").replace(/\}/g,"\\}").replace(/\[/g,"\\[").replace(/\]/g,"\\]"):""},Rep_AddPriceComma:function(e){return e?String(e).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"):""},Rep_numZeroPadding:function(e,r){var n=e;n||(n=0);for(var t="",i=0;r>i;i++)t+="0";return(t+String(n)).slice(-1*r)},Rep_SpacePaddingString:function(r,n){var t=r;t||(t=""),t=String(t);var i=e(t),o="",a=n-i;0>a&&(a=0);for(var c=0;a>c;c++)o+=" ";return t+o},Rep_HEXColorToRGBColor:function(e){if(e&&""!=e){if(4==e.length)var r=e.match(/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})/),n=r[1]+r[1],t=r[2]+r[2],i=r[3]+r[3];else{if(7!=e.length)return null;var o=e.match(/^#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})/),n=o[1],t=o[2],i=o[3]}var a=parseInt(n,16),c=parseInt(t,16),l=parseInt(i,16);return"rgb("+a+", "+c+", "+l+")"}return null},getCharCount:function(r){return r?e(r):0}}},_Log=new function(){function e(e){return"black"==e?"[30m":"red"==e?"[31m":"green"==e?"[32m":"yellow"==e?"[33m":"blue"==e?"[34m":"magenta"==e?"[35m":"cyan"==e?"[36m":"white"==e?"[37m":"[0m"}function r(){var e=new Array("日","月","火","水","木","金","土"),r=new Date,n=r.getYear(),t=r.getMonth()+1,i=r.getDate(),o=(e[r.getDay()],r.getHours()),a=r.getMinutes(),c=r.getSeconds();return 2e3>n&&(n+=1900),10>t&&(t="0"+t),10>i&&(i="0"+i),10>o&&(o="0"+o),10>a&&(a="0"+a),10>c&&(c="0"+c),n+"/"+t+"/"+i+" "+o+":"+a+":"+c}var n=[],t=!0;return{log:function(i,o,a,c){var l=!0;if(n&&n.length>0){l=!1;for(var u=0;u<n.length;u++)if(n[u]==i){l=!0;break}}if(l){var g=_RepStrUtil.Rep_SpacePaddingString(i,16),f=_RepStrUtil.Rep_SpacePaddingString(a,16),p=t?r():"";o?console.error(" "+e("red")+p+" "+e("cyan")+g+e()+e("white")+f+e()+e("red")+c+e()):console.log(" "+p+" "+e("cyan")+g+e()+e("white")+f+e()+c)}},setFilterModuleName:function(e){n=e},isVisibleDate:function(e){t=e}}},_WriteFile=new function(){var e=require("fs"),r=require("mkdirp"),n=require("path").dirname;return{write:function(t,i,o){r(n(t),function(r){return r?o(r):void e.writeFile(t,i,o)})},writeFromBuffer:function(t,i,o){r(n(t),function(r){return r?o(r):void e.open(t,"w",function(r,n){return r?o(r):void e.write(n,i,0,i.length,0,function(r){return r?o(r):void e.close(n,function(){o(null)})})})})}}},_ProcessTimeINST=new function(){function e(e){var r=Math.floor(e/36e5),n=Math.floor((e-36e5*r)/6e4),t=Math.floor((e-36e5*r-6e4*n)/1e3),i=e-36e5*r-6e4*n-1e3*t;return r+"h "+n+"m "+t+"s "+i+"ms ("+e+"ms)"}function r(){a=new Date,a=i.getTime()}function n(){i=new Date,o=i.getTime()}function t(){i=new Date,c=i.getTime()}var i,o,a,c;return{startTimerINSTL:function(){n(),r()},getTotalTimerINSTL:function(){t();var r=c-a;return[r,e(r)]},getTimerINSTL:function(){t();var r=c-o;return n(),[r,e(r)]}}};process.on("message",function(e){if("dl"==e.processName){var r=require("request-promise"),n={uri:e.url+"/dm",json:{file:e.file},method:"post",encoding:null};_ProcessTimeINST.startTimerINSTL(),r(n).then(function(e){var r="./tmpF/m/"+n.json.file;_Log.log("child_download",!1,"DL完了",_ProcessTimeINST.getTimerINSTL()[1]),_WriteFile.write(r,e,function(e){e?(process.send({state:!1}),process.exit(0)):(_Log.log("child_download",!1,"保存",n.json.file),process.send({state:!0}),process.exit(0))})})["catch"](function(e){_Log.log("child_download",!0,"接続エラー",e),process.send({state:!1}),process.exit(0)})}});